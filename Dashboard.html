<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grocery Admin Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
<style>
body { font-family: 'Inter', sans-serif; }
.page { display: none; }
.page.active { display: block; }
body::-webkit-scrollbar { display: none; }
body { -ms-overflow-style: none; scrollbar-width: none; }
.tab-image { width: 100%; height: 150px; object-fit: cover; border-radius: 0.5rem; }
</style>
</head>
<body class="bg-gray-100 text-gray-900">

<!-- Loading Spinner -->
<div id="loading-container" class="flex items-center justify-center min-h-screen bg-gray-100">
  <svg class="animate-spin -ml-1 mr-3 h-10 w-10 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
  </svg>
</div>

<!-- Login Page -->
<div id="login-page" class="flex flex-col items-center justify-center min-h-screen bg-gray-100">
  <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-sm text-center">
    <h2 class="text-2xl font-bold text-gray-800 mb-6">Select Your Role</h2>
    <div class="space-y-4">
      <button id="manager-btn" class="w-full py-3 px-4 rounded-md text-white bg-indigo-600 hover:bg-indigo-700 transition-colors">
        <i data-lucide="user-cog" class="w-5 h-5 mr-2"></i> Manager
      </button>
      <button id="shop-assistant-btn" class="w-full py-3 px-4 rounded-md text-gray-700 border border-gray-300 bg-white hover:bg-gray-50 transition-colors">
        <i data-lucide="user" class="w-5 h-5 mr-2"></i> Shop Assistant
      </button>
    </div>
  </div>
</div>

<!-- Dashboard -->
<div id="main-dashboard-container" class="flex min-h-screen hidden">
  <!-- Sidebar -->
  <aside id="sidebar" class="fixed inset-y-0 left-0 z-40 w-64 p-6 bg-white shadow-xl transform -translate-x-full transition-transform duration-300 ease-in-out lg:relative lg:translate-x-0 lg:flex lg:flex-col">
    <div class="flex items-center justify-between lg:justify-start mb-10">
      <h1 class="text-2xl font-bold text-indigo-600">Grocery Admin</h1>
      <button id="sidebar-close-btn" class="p-2 text-gray-700 lg:hidden"><i data-lucide="x" class="w-6 h-6"></i></button>
    </div>
    <nav id="nav-container" class="space-y-2 flex-grow"></nav>
    <div class="mt-8 pt-4 border-t border-gray-200">
      <button id="switch-role-btn" class="w-full flex items-center justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
        <i data-lucide="shuffle" class="w-4 h-4 mr-2"></i> Switch Role
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-8 overflow-y-auto">
    <button id="sidebar-open-btn" class="fixed top-4 left-4 z-50 p-2 text-gray-700 bg-white rounded-lg shadow-md lg:hidden">
      <i data-lucide="menu" class="w-6 h-6"></i>
    </button>

    <!-- Dashboard Page -->
    <div id="dashboard" class="page">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Dashboard</h2>
      <div id="dashboard-metrics" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </div>

    <!-- Products Page -->
    <div id="products" class="page">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Products</h2>
        <button id="add-product-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-indigo-700 transition-colors">Add New Product</button>
      </div>
      <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
        <table class="w-full text-left table-auto">
          <thead>
            <tr class="bg-gray-50 text-gray-600 uppercase text-sm leading-normal">
              <th class="py-3 px-6">Product</th>
              <th class="py-3 px-6">Category</th>
              <th class="py-3 px-6">Stock</th>
              <th class="py-3 px-6">Price</th>
              <th class="py-3 px-6">Unit</th>
              <th class="py-3 px-6">Rating</th>
              <th class="py-3 px-6">Actions</th>
            </tr>
          </thead>
          <tbody id="products-table-body" class="text-gray-600 text-sm font-light"></tbody>
        </table>
      </div>
      <div class="product-grid row grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6" id="productsGridAll"></div>
    </div>
  </main>
</div>

<!-- Product Modal -->
<div id="product-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-lg">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl font-bold text-gray-800">Add / Edit Product</h3>
      <button id="product-modal-close" class="text-gray-600 hover:text-gray-900">
        <i data-lucide="x" class="w-6 h-6"></i>
      </button>
    </div>
    <div class="space-y-4">
      <input type="text" id="product-name" placeholder="Product Name" class="w-full px-4 py-2 border rounded-lg">
      <input type="text" id="product-category" placeholder="Category" class="w-full px-4 py-2 border rounded-lg">
      <input type="number" id="product-stock" placeholder="Stock" class="w-full px-4 py-2 border rounded-lg">
      <input type="text" id="product-unit" placeholder="Unit (kg, g, liter)" class="w-full px-4 py-2 border rounded-lg">
      <input type="number" step="0.01" id="product-price" placeholder="Price" class="w-full px-4 py-2 border rounded-lg">
      <input type="text" id="product-discount" placeholder="Discount" class="w-full px-4 py-2 border rounded-lg">
      <input type="number" id="product-rating" placeholder="Rating (0-5)" min="0" max="5" class="w-full px-4 py-2 border rounded-lg">
      <input type="file" id="product-image" accept="image/*" class="w-full px-4 py-2 border rounded-lg">
    </div>
    <div class="mt-6 flex justify-end space-x-3">
      <button id="product-modal-cancel" class="px-4 py-2 rounded-lg border hover:bg-gray-50">Cancel</button>
      <button id="product-modal-save" class="px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700">Save</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    document.getElementById('loading-container').style.display = 'none';
    document.getElementById('login-page').style.display = 'flex';
  }, 1000);

  lucide.createIcons();

  const pages = document.querySelectorAll('.page');
  const navContainer = document.getElementById('nav-container');
  const loginPage = document.getElementById('login-page');
  const mainDashboard = document.getElementById('main-dashboard-container');
  const roles = { manager:['Dashboard','Products'], assistant:['Dashboard','Products'] };
  let currentRole = '';
  let editingProductId = null;

  const showPage = (pageName) => {
    pages.forEach(p => p.classList.remove('active'));
    const page = document.getElementById(pageName.toLowerCase().replace(/ /g,'-'));
    if(page) page.classList.add('active');
  };

  const setupNav = (role) => {
    navContainer.innerHTML = '';
    roles[role].forEach(item => {
      const btn = document.createElement('button');
      btn.textContent = item;
      btn.className='w-full text-left py-2 px-3 rounded hover:bg-gray-100 transition';
      btn.addEventListener('click',()=>showPage(item));
      navContainer.appendChild(btn);
    });
    showPage(roles[role][0]);
  };

  const openDashboard = (role) => {
    currentRole = role;
    loginPage.style.display='none';
    mainDashboard.classList.remove('hidden');
    setupNav(role);
  };

  document.getElementById('manager-btn').addEventListener('click',()=>openDashboard('manager'));
  document.getElementById('shop-assistant-btn').addEventListener('click',()=>openDashboard('assistant'));
  document.getElementById('switch-role-btn').addEventListener('click',()=>{
    mainDashboard.classList.add('hidden');
    loginPage.style.display='flex';
  });

  // Sidebar toggle
  const sidebar = document.getElementById('sidebar');
  document.getElementById('sidebar-open-btn').addEventListener('click',()=>sidebar.classList.remove('-translate-x-full'));
  document.getElementById('sidebar-close-btn').addEventListener('click',()=>sidebar.classList.add('-translate-x-full'));

  // Product Modal
  const productModal = document.getElementById('product-modal');
  document.getElementById('add-product-btn').addEventListener('click',()=>{
    editingProductId = null;
    productModal.classList.remove('hidden');
  });
  const closeProductModal = ()=>productModal.classList.add('hidden');
  document.getElementById('product-modal-close').addEventListener('click', closeProductModal);
  document.getElementById('product-modal-cancel').addEventListener('click', closeProductModal);

  // LocalStorage helpers
  const getProducts = ()=>JSON.parse(localStorage.getItem('products')||'[]');
  const saveProducts = (products)=>localStorage.setItem('products', JSON.stringify(products));

  // Render products table & grid
  const renderProducts = () => {
    const products = getProducts();
    const tbody = document.getElementById('products-table-body');
    const grid = document.getElementById('productsGridAll');
    tbody.innerHTML=''; grid.innerHTML='';

    products.forEach(p=>{
      // Table row
      const tr = document.createElement('tr');
      tr.className='border-b border-gray-200 hover:bg-gray-50';
      tr.innerHTML=`
        <td class="py-3 px-6">${p.name}</td>
        <td class="py-3 px-6">${p.category}</td>
        <td class="py-3 px-6">${p.stock}</td>
        <td class="py-3 px-6">R ${parseFloat(p.price).toFixed(2)}</td>
        <td class="py-3 px-6">${p.unit}</td>
        <td class="py-3 px-6">${p.rating}</td>
        <td class="py-3 px-6">
          <button class="text-indigo-600 hover:underline" onclick="editProduct(${p.id})">Edit</button>
          <button class="text-red-600 hover:underline" onclick="deleteProduct(${p.id})">Delete</button>
        </td>
      `;
      tbody.appendChild(tr);

      // Grid item
      grid.insertAdjacentHTML('beforeend',`
        <div class="product-item swiper-slide border p-3 rounded-lg relative">
          <span class="badge bg-success absolute top-2 left-2 px-2 py-1 rounded">${p.discount || ''}</span>
          <figure><img src="${p.image}" class="tab-image mb-2"></figure>
          <h3 class="font-bold">${p.name}</h3>
          <span class="qty">${p.stock} ${p.unit}</span>
          <span class="rating block">‚≠ê ${p.rating}</span>
          <span class="price block">R ${parseFloat(p.price).toFixed(2)}</span>
        </div>
      `);
    });
  };

  window.editProduct = (id)=>{
    editingProductId=id;
    const p=getProducts().find(p=>p.id===id);
    if(!p) return;
    ['name','category','stock','unit','price','discount','rating'].forEach(field=>{
      document.getElementById(`product-${field}`).value=p[field]||'';
    });
    productModal.classList.remove('hidden');
  };

  window.deleteProduct = (id)=>{
    const products=getProducts().filter(p=>p.id!==id);
    saveProducts(products);
    renderProducts();
  };

  // Save Product with image upload
  document.getElementById('product-modal-save').addEventListener('click', () => {
    const name = document.getElementById('product-name').value.trim();
    const category = document.getElementById('product-category').value.trim();
    const stock = parseInt(document.getElementById('product-stock').value);
    const unit = document.getElementById('product-unit').value.trim();
    const price = parseFloat(document.getElementById('product-price').value);
    const discount = document.getElementById('product-discount').value.trim();
    const rating = parseFloat(document.getElementById('product-rating').value);
    const imageInput = document.getElementById('product-image');

    if (!name || !category || isNaN(stock) || !unit || isNaN(price) || isNaN(rating) || (!imageInput.files.length && !editingProductId)) {
        alert('Please fill all fields correctly and select an image');
        return;
    }

    const saveProductData = (image) => {
        let products = getProducts();
        if(editingProductId){
            products = products.map(p => p.id === editingProductId ? {
                ...p, name, category, stock, unit, price, discount, rating, image: image || p.image
            } : p);
        } else {
            products.push({ id: Date.now(), name, category, stock, unit, price, discount, rating, image });
        }

        saveProducts(products);
        renderProducts();
        closeProductModal();
        ['product-name','product-category','product-stock','product-unit','product-price','product-discount','product-rating','product-image']
            .forEach(id=>document.getElementById(id).value='');
    };

    if(imageInput.files.length){
        const reader = new FileReader();
        reader.onload = function(e){
            saveProductData(e.target.result);
        };
        reader.readAsDataURL(imageInput.files[0]);
    } else {
        saveProductData(null);
    }
  });

  renderProducts();
});
</script>
</body>
</html>
